import {ContainedFQN} from "org/mdspex/QualifiedNames";
import {Assert} from "n4/mangel/assert/Assert";

export public class ContainedFQNTests {

	@Test
	public fields() {
		let fqn = new ContainedFQN("t", "x");

		Assert.equal(fqn.type, "t");
		Assert.equal(fqn.lastSegment, "x");
		Assert.isTrue(fqn.isFull);
		Assert.isFalse(fqn.isPartial);
	}

	@Test
	public segmentsSingleton() {
		let fqn = new ContainedFQN("t", "x");
		let i = 0;
		for (let s of fqn.segments) {
			Assert.equal(s, "x");
			Assert.lessThan(i, 1);
			i++;
		}
	}

	@Test
	public reversedSegmentsSingleton() {
		let fqn = new ContainedFQN("t", "x");
		let i = 0;
		for (let s of fqn.reversedSegments) {
			Assert.equal(s, "x");
			Assert.lessThan(i, 1);
			i++;
		}
	}

	@Test
	public segments() {
		let fqn = new ContainedFQN("t", "x", new ContainedFQN("t", "y", new ContainedFQN("t", "z")));
		let segs = ["z", "y", "x" ];
		let i = 0;
		for (let s of fqn.segments) {
			Assert.isTrue(i < segs.length);
			Assert.equal(s, segs[i]);
			i++;
		}
		Assert.equal(i, segs.length);
	}

	@Test
	public reversedSegments() {
		let fqn = new ContainedFQN("t", "x", new ContainedFQN("t", "y", new ContainedFQN("t", "z")));
		let segs = ["x", "y", "z" ];
		let i = 0;
		for (let s of fqn.reversedSegments) {
			Assert.isTrue(i < segs.length);
			Assert.equal(s, segs[i]);
			i++;
		}
		Assert.equal(i, segs.length);
	}

	@Test
	public manySegments() {

		let start = Date.now();

		let max = 100000;
		let fqn: ContainedFQN = undefined;
		for (let i = 0; i < max; i++) {
			fqn = new ContainedFQN("t", "x" + i, fqn);
		}
		let i = 0;
		for (let s of fqn.segments) {
			Assert.lessThan(i, max);
			Assert.equal(s, "x" + i);
			i++;
		}

		let end = Date.now();
		Assert.lessThan(end - start, 1500); // 170 ms on MacBook Pro

	}

	@Test
	public manyReversedSegments() {
		let start = Date.now();

		let max = 100000;
		let fqn: ContainedFQN = undefined;
		for (let i = 0; i < max; i++) {
			fqn = new ContainedFQN("t", "x" + i, fqn);
		}
		let i = max - 1;
		for (let s of fqn.reversedSegments) {
			Assert.greaterThanOrEqual(i, 0);
			Assert.equal(s, "x" + i);
			i--;
		}

		let end = Date.now();
		Assert.lessThan(end - start, 1000); // 120 ms on MacBook Pro
	}

	@Test
	public testToString() {
		let fqn = new ContainedFQN("t1", "x", new ContainedFQN("t2", "y", new ContainedFQN("t3", "z")));
		Assert.equal(fqn.toString(), "t1:z.y.x");
		Assert.equal(fqn.parent.toString(), "t2:z.y");
		Assert.equal(fqn.parent.parent.toString(), "t3:z");
	}

	

}
